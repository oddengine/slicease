<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" dir="ltr" lang="en">
<head>
	<title>Html5 Canvas Test</title>
	<link type="text/css" rel="stylesheet" href="css/style.css" />
	
</head>
<body>
	<div id='wrap'></div>
	
	<script type="text/javaScript">
		m = function() {
			return new m.a();
		};
		m.vs = '0.1';
		
		(function(m) {
			m.a = function() {
				var _this = m.u.ext(this, new m.d());
				_this.v = new m.v(_this);
				_this.c = new m.c(_this);
			};
		})(m);
		
		(function(m) {
			var _l = {};
			m.d = function() {
				this.add = function(tp, cb) {
					if (_l.hasOwnProperty(tp) == false) {
						_l[tp] = [];
					}
					_l[tp].push({cb: cb});
				};
				
				this.send = function(tp, dt) {
					var _dt = dt || {};
					_dt.tp = tp;
					if (_l.hasOwnProperty(tp) == false) {
						return;
					}
					for (var i=0; i<_l[tp].length; i++) {
						var cb = _l[tp][i].cb;
						cb(_dt);
					}
				};
			};
		})(m);
		
		(function(w) {
			var m = w.m;
			
			m.v = function(_a) {
				var _this = m.u.ext(this, new m.d());
				
				_a.add('type1', function(e) {
					m.u.log(e.tp + ' dispatched.');
				});
				
				var div = document.createElement('div');
				div.style.width = '100px';
				div.style.height = '24px';
				div.style.background = '#ccc';
				var wrap = document.getElementById('wrap');
				wrap.appendChild(div);
				div.onclick = function() {
					_this.send('type1');
				};
			};
		})(window);
		
		(function(m) {
			m.c = function(_a) {
				var _this = m.u.ext(this, new m.d());
				
				_a.add('type2', function(e) {
					m.u.log(e.tp + ' dispatched.');
				});
				
				var div = document.createElement('div');
				div.style.width = '100px';
				div.style.height = '24px';
				div.style.background = '#999';
				var wrap = document.getElementById('wrap');
				wrap.appendChild(div);
				div.onclick = function() {
					_this.send('type2');
				};
			};
		})(m);
		
		(function(m) {
			var u = m.u = {};
			u.ext = function() {
				var args = Array.prototype.slice.call(arguments, 0);
				if (args.length > 1) {
		            var objectToExtend = args[0],
		                extendEach = function(element, arg) {
		                    if (arg !== undefined && arg !== null) {
		                        objectToExtend[element] = arg;
		                    }
		                };
		            for (var i = 1; i < args.length; i++) {
		                u.foreach(args[i], extendEach);
		            }
		            return objectToExtend;
		        }
		        return null;
			};
			
			u.foreach = function(aData, fnEach) {
		        var key, val;
		        for (key in aData) {
	                if (aData.hasOwnProperty(key)) {
	                    val = aData[key];
	                    fnEach(key, val);
	                }
		        }
		    };
		    
		    var console = window.console = window.console || {
		        log: function() {}
		    };
		    u.log = function() {
		        var args = Array.prototype.slice.call(arguments, 0);
		        if (typeof console.log === 'object') {
		            console.log(args);
		        } else {
		            console.log.apply(console, args);
		        }
		    };
		})(m);
		
		var _m = m();
	</script>
</body>
</html>